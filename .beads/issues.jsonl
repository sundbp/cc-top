{"id":"cc-top-0lq","title":"Fix j/k key binding conflict for event scrolling","description":"tui/keys.go binds both Up/Down and ScrollUp/ScrollDown to j/k keys. In handleDashboardKey(), Up/Down are checked before ScrollUp/ScrollDown, so pressing j/k always triggers session navigation, never event scrolling. Manual event scrolling via j/k is unreachable. Fix: use separate key bindings for event scrolling (e.g., Ctrl+J/Ctrl+K, or PgUp/PgDn, or dedicated scroll keys when event panel is focused).","status":"closed","priority":2,"issue_type":"bug","owner":"riabtchuk@gmail.com","created_at":"2026-02-15T04:22:01.191225Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T04:43:25.985729Z","closed_at":"2026-02-15T04:43:25.985729Z","close_reason":"Fixed by parallel agent team"}
{"id":"cc-top-8he","title":"Fix loop detector duplicate event accumulation","description":"alerts/rules.go loopDetectorRule.Evaluate() re-processes ALL events from the store every evaluation cycle. Events already processed and added to r.failures get re-appended, causing duplicate timestamps. A single failure gets counted N times (N = number of eval cycles since event added). Loop detector fires prematurely/incorrectly. Fix: track last-processed event index or timestamp to skip already-seen events.","status":"closed","priority":1,"issue_type":"bug","owner":"riabtchuk@gmail.com","created_at":"2026-02-15T04:21:44.242048Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T04:43:25.953322Z","closed_at":"2026-02-15T04:43:25.953322Z","close_reason":"Fixed by parallel agent team"}
{"id":"cc-top-b6t","title":"Fix alert threshold defaults to match spec","description":"config/defaults.go has CostSurgeThresholdPerHour=100.00 (spec says 2.00, 50x too high) and RunawayTokenVelocity=200000 (spec says 50000, 4x too high). These defaults mean alerts practically never fire under normal usage. Fix: set defaults to spec values in defaults.go.","status":"closed","priority":2,"issue_type":"bug","owner":"riabtchuk@gmail.com","created_at":"2026-02-15T04:21:51.988106Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T04:43:25.974889Z","closed_at":"2026-02-15T04:43:25.974889Z","close_reason":"Fixed by parallel agent team"}
{"id":"cc-top-cv7","title":"Fix cumulative counter mishandling in stats calculator","description":"stats/calculator.go computeLinesOfCode() and computeCounterMetric() sum raw metric m.Value across all data points. For cumulative counters, if a session reports commit count as 1, then 2, then 3, this sums to 6 instead of 3. Only the latest value (or delta) should be used. Affects: lines of code, commits, PRs stats.","status":"closed","priority":1,"issue_type":"bug","owner":"riabtchuk@gmail.com","created_at":"2026-02-15T04:21:49.395844Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T04:43:25.971581Z","closed_at":"2026-02-15T04:43:25.971581Z","close_reason":"Fixed by parallel agent team"}
{"id":"cc-top-dzh","title":"Add global config file reading to process scanner","description":"Spec Step 4 of Process Discovery requires reading ~/.claude/settings.json env block and /Library/Application Support/ClaudeCode/managed-settings.json to determine telemetry status for all sessions regardless of per-process env vars. Currently the scanner only reads per-process env vars via KERN_PROCARGS2. A process configured via settings.json (not shell env) shows incorrect 'No telemetry' status until data actually flows. The hasReceivedData override partially masks this but initial classification is wrong.","status":"closed","priority":2,"issue_type":"feature","owner":"riabtchuk@gmail.com","created_at":"2026-02-15T04:21:58.626192Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T04:43:25.982551Z","closed_at":"2026-02-15T04:43:25.982551Z","close_reason":"Fixed by parallel agent team"}
{"id":"cc-top-eho","title":"Task Graph: M1 - Foundation","status":"closed","priority":0,"issue_type":"epic","owner":"riabtchuk@gmail.com","created_at":"2026-02-15T01:46:24.909577Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:32:26.986807Z","closed_at":"2026-02-15T02:32:26.986807Z","close_reason":"All 25 child tasks completed. Full build passes, all tests pass with -race.","labels":["taskval-managed"]}
{"id":"cc-top-eho.1","title":"Scaffold Go project structure with module, directories, and main entrypoint","description":"The cc-top Go module is initialized with package layout, main.go entrypoint, and go.mod with core dependencies (Bubble Tea, OTLP, TOML).\n\n## Inputs\n- **spec** (`string`): cc-top-v1-spec.md and cc-top-v1-plan-spec.md -- Source: Project documentation\n\n## Outputs\n- **go_module** (`Go module`): Valid go.mod with module path -- Dest: Project root\n- **directory_structure** (`directories`): Standard Go layout -- Dest: Project root\n\n## Constraints\n- Follow standard Go project layout conventions\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"scaffold-project\",\"files_scope\":[\"go.mod\",\"go.sum\",\"cmd/cc-top/main.go\",\"internal/**\"],\"effects\":\"\",\"inputs\":[{\"name\":\"spec\",\"type\":\"string\",\"constraints\":\"cc-top-v1-spec.md and cc-top-v1-plan-spec.md\",\"source\":\"Project documentation\"}],\"outputs\":[{\"name\":\"go_module\",\"type\":\"Go module\",\"constraints\":\"Valid go.mod with module path\",\"destination\":\"Project root\"},{\"name\":\"directory_structure\",\"type\":\"directories\",\"constraints\":\"Standard Go layout\",\"destination\":\"Project root\"}]}}","acceptance_criteria":"- go.mod exists with module github.com/nixlim/cc-top\n- go build ./... succeeds\n- Directories exist: cmd/cc-top/, internal/config/, internal/state/, internal/receiver/, internal/scanner/, internal/correlator/, internal/settings/, internal/burnrate/, internal/events/, internal/alerts/, internal/stats/, internal/tui/, internal/process/\n- cmd/cc-top/main.go contains a main() function that compiles","status":"closed","priority":0,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T01:46:25.542211Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:14:08.197001Z","closed_at":"2026-02-15T02:14:08.197001Z","close_reason":"Scaffold complete: go.mod, all directories, type stubs, main.go, go build succeeds","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.1","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:25.54685Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.10","title":"Implement burn rate calculator with rolling averages and trend detection","description":"The burn rate calculator computes total session cost, rolling 5-minute $/hour rate, trend direction, token velocity, and maps rates to color thresholds.\n\n## Inputs\n- **cost_metrics** (`list\u003cCostMetric\u003e`): Cumulative cost.usage values with timestamps -- Source: State store\n- **token_metrics** (`list\u003cTokenMetric\u003e`): Cumulative token.usage counter values -- Source: State store\n- **thresholds** (`ColorThresholds`): Green below X, yellow below Y, red at Y+ -- Source: Config\n\n## Outputs\n- **burn_rate** (`BurnRate struct`): Total \u003e= 0, rate \u003e= 0 -- Dest: TUI burn rate panel\n\n## Constraints\n- Numerically accurate to within $0.01 for cost and 1 token/minute for velocity\n- Handle counter resets gracefully (negative delta = reset)\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-burn-rate-calculator\",\"files_scope\":[\"internal/burnrate/calculator.go\",\"internal/burnrate/calculator_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"cost_metrics\",\"type\":\"list\\u003cCostMetric\\u003e\",\"constraints\":\"Cumulative cost.usage values with timestamps\",\"source\":\"State store\"},{\"name\":\"token_metrics\",\"type\":\"list\\u003cTokenMetric\\u003e\",\"constraints\":\"Cumulative token.usage counter values\",\"source\":\"State store\"},{\"name\":\"thresholds\",\"type\":\"ColorThresholds\",\"constraints\":\"Green below X, yellow below Y, red at Y+\",\"source\":\"Config\"}],\"outputs\":[{\"name\":\"burn_rate\",\"type\":\"BurnRate struct\",\"constraints\":\"Total \\u003e= 0, rate \\u003e= 0\",\"destination\":\"TUI burn rate panel\"}]}}","acceptance_criteria":"- TotalCost() returns the sum of cost.usage across visible sessions\n- HourlyRate() with $0.25 in last 5 minutes returns $3.00/hr\n- HourlyRate() with $0.00 in last 5 minutes returns $0.00/hr\n- TrendDirection() returns Up when current 5-min window ($0.30) exceeds previous ($0.20)\n- TrendDirection() returns Down when current window is lower than previous\n- TrendDirection() returns Flat when windows are equal\n- ColorForRate($0.25/hr) returns Green with default thresholds\n- ColorForRate($1.00/hr) returns Yellow with default thresholds\n- ColorForRate($2.00/hr) returns Red with default thresholds\n- Custom thresholds from config override defaults\n- TokenVelocity() returns tokens per minute from counter deltas\n- Counter reset (prev $5.00, curr $0.50) treats previous as 0 and calculates from $0.50\n- TestBurnRate_TotalCost passes\n- TestBurnRate_RollingHourly passes\n- TestBurnRate_TrendDirection passes\n- TestBurnRate_ColourThresholds passes\n- TestBurnRate_CustomThresholds passes\n- TestBurnRate_TokenVelocity passes\n- TestBurnRate_CounterReset passes","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:30.928745Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:27:05.237727Z","closed_at":"2026-02-15T02:27:05.237727Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.10","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:30.929946Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.10","depends_on_id":"cc-top-eho.3","type":"blocks","created_at":"2026-02-15T01:46:44.387956Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.10","depends_on_id":"cc-top-eho.2","type":"blocks","created_at":"2026-02-15T01:46:44.787762Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.11","title":"Implement event formatter for all 5 OTLP event types","description":"The event formatter converts raw OTLP events into display-ready strings with type-specific formatting for user_prompt, tool_result, api_request, api_error, and tool_decision events.\n\n## Inputs\n- **event** (`OTLPEvent`): One of 5 known event types -- Source: State store\n\n## Outputs\n- **formatted** (`FormattedEvent`): Display string with session attribution, type icon, and details -- Dest: Event stream panel\n\n## Constraints\n- Token counts above 1000 display as 'Xk' (e.g., 2100 -\u003e 2.1k)\n- Durations display as seconds with 1 decimal place (e.g., 1200ms -\u003e 1.2s)\n- Cost displays with 2 decimal places prefixed by $ (e.g., $0.03)\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-event-formatter\",\"files_scope\":[\"internal/events/formatter.go\",\"internal/events/formatter_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"event\",\"type\":\"OTLPEvent\",\"constraints\":\"One of 5 known event types\",\"source\":\"State store\"}],\"outputs\":[{\"name\":\"formatted\",\"type\":\"FormattedEvent\",\"constraints\":\"Display string with session attribution, type icon, and details\",\"destination\":\"Event stream panel\"}]}}","acceptance_criteria":"- user_prompt event with prompt_length=342 for sess-abc formats as '[sess-abc] Prompt (342 chars)'\n- tool_result event with tool_name=Bash, success=true, duration_ms=1200 formats as '[session] Bash (1.2s)'\n- tool_result event with tool_name=Edit, success=false, decision=reject formats as '[session] Edit rejected by user'\n- api_request event with model=sonnet-4.5, input_tokens=2100, output_tokens=890, cost_usd=0.03, duration_ms=4200 formats as '[session] sonnet-4.5 -\u003e 2.1k in / 890 out ($0.03) 4.2s'\n- api_error event with status_code=529, error=overloaded, attempt=2 formats as '[session] 529 overloaded (attempt 2)'\n- tool_decision event with tool_name=Write, decision=accept, source=config formats as '[session] Write accepted (config)'\n- TestEventFormat_UserPrompt passes\n- TestEventFormat_ToolResultSuccess passes\n- TestEventFormat_ToolResultReject passes\n- TestEventFormat_APIRequest passes\n- TestEventFormat_APIError passes\n- TestEventFormat_ToolDecision passes","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T01:46:31.511654Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:19:34.131055Z","closed_at":"2026-02-15T02:19:34.131055Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.11","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:31.512915Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.11","depends_on_id":"cc-top-eho.3","type":"blocks","created_at":"2026-02-15T01:46:45.180605Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.12","title":"Implement aggregate statistics calculator for the stats dashboard","description":"The stats calculator computes 9 aggregate metrics (lines of code, commits, PRs, tool acceptance rate, cache efficiency, average API latency, model breakdown, top tools, error rate) from state store data.\n\n## Inputs\n- **state** (`StateStore`): Contains all metrics and events -- Source: State store\n\n## Outputs\n- **stats** (`DashboardStats`): All 9 statistics computed -- Dest: TUI stats dashboard\n\n## Constraints\n- Pure computation from state store data — no side effects\n- Cache efficiency = cacheRead / (input + cacheRead), handle division by zero\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-stats-calculator\",\"files_scope\":[\"internal/stats/calculator.go\",\"internal/stats/calculator_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"state\",\"type\":\"StateStore\",\"constraints\":\"Contains all metrics and events\",\"source\":\"State store\"}],\"outputs\":[{\"name\":\"stats\",\"type\":\"DashboardStats\",\"constraints\":\"All 9 statistics computed\",\"destination\":\"TUI stats dashboard\"}]}}","acceptance_criteria":"- LinesOfCode() with type=added totalling 150 and type=removed totalling 30 returns {Added: 150, Removed: 30}\n- CommitsAndPRs() returns {Commits: 5, PRs: 2} when those counter metrics are present\n- ToolAcceptanceRate() with Edit accept=8, reject=2 returns {Edit: 80%}\n- CacheEfficiency() with cacheRead=80000 and input=20000 returns 80%\n- AvgAPILatency() with 10 api_request events averaging 3500ms returns 3.5s\n- ModelBreakdown() groups cost and tokens by model name\n- TopTools() ranks tools by frequency in descending order\n- ErrorRate() with 100 api_request and 5 api_error events returns 5.0%\n- TestStatsCalc_LinesOfCode passes\n- TestStatsCalc_CacheEfficiency passes\n- TestStatsCalc_ErrorRate passes\n- TestStatsCalc_ToolAcceptRate passes\n- TestStatsCalc_AvgLatency passes","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:32.107326Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:22:33.30463Z","closed_at":"2026-02-15T02:22:33.30463Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.12","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:32.108628Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.12","depends_on_id":"cc-top-eho.3","type":"blocks","created_at":"2026-02-15T01:46:45.560218Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.13","title":"Implement --setup CLI flag for non-interactive telemetry configuration","description":"The cc-top --setup command runs settings merge in non-interactive mode, prints the result, and exits without starting the TUI.\n\n## Inputs\n- **setup_flag** (`bool`): Set via CLI --setup flag -- Source: CLI argument\n\n## Outputs\n- **stdout_message** (`string`): Success, already-configured, or error message -- Dest: stdout\n- **exit_code** (`int`): 0 on success, 1 on error -- Dest: Process exit code\n\n## Constraints\n- Non-interactive mode only — no TUI, no prompts\n- Must exit immediately after merge operation\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-cli-setup-command\",\"files_scope\":[\"cmd/cc-top/main.go\",\"cmd/cc-top/setup.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"setup_flag\",\"type\":\"bool\",\"constraints\":\"Set via CLI --setup flag\",\"source\":\"CLI argument\"}],\"outputs\":[{\"name\":\"stdout_message\",\"type\":\"string\",\"constraints\":\"Success, already-configured, or error message\",\"destination\":\"stdout\"},{\"name\":\"exit_code\",\"type\":\"int\",\"constraints\":\"0 on success, 1 on error\",\"destination\":\"Process exit code\"}]}}","acceptance_criteria":"- cc-top --setup with no existing settings.json creates the file and prints 'Settings written'\n- cc-top --setup with already-configured file prints 'Already configured' and exits 0\n- cc-top --setup with malformed settings.json prints the error and exits 1\n- cc-top --setup does not start the TUI or OTLP receivers\n- cc-top --setup with a differing endpoint value prints a warning and does not overwrite","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T01:46:32.706752Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:22:47.245464Z","closed_at":"2026-02-15T02:22:47.245464Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.13","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:32.708188Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.13","depends_on_id":"cc-top-eho.4","type":"blocks","created_at":"2026-02-15T01:46:45.945556Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.13","depends_on_id":"cc-top-eho.1","type":"blocks","created_at":"2026-02-15T01:46:46.343353Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.14","title":"Implement telemetry status classifier for Claude Code processes","description":"The classifier reads a process's environment variables and categorizes its telemetry status as one of: Connected, Waiting, Wrong port, Console only, No telemetry, or Unknown.\n\n## Inputs\n- **process_info** (`ProcessInfo`): Must include env vars or EnvReadable=false flag -- Source: Process scanner\n\n## Outputs\n- **status** (`TelemetryStatus`): One of 6 enum values with icon and label -- Dest: Session list display\n\n## Constraints\n- Pure function: classify based on env vars and config only\n- Must compare against configured port, not hardcoded default\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-telemetry-classifier\",\"files_scope\":[\"internal/scanner/classifier.go\",\"internal/scanner/classifier_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"process_info\",\"type\":\"ProcessInfo\",\"constraints\":\"Must include env vars or EnvReadable=false flag\",\"source\":\"Process scanner\"}],\"outputs\":[{\"name\":\"status\",\"type\":\"TelemetryStatus\",\"constraints\":\"One of 6 enum values with icon and label\",\"destination\":\"Session list display\"}]}}","acceptance_criteria":"- Classify returns Connected with checkmark icon when CLAUDE_CODE_ENABLE_TELEMETRY=1 and OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317\n- Classify returns WrongPort with warning icon when CLAUDE_CODE_ENABLE_TELEMETRY=1 and endpoint points to port 9090\n- Classify returns ConsoleOnly with warning icon when CLAUDE_CODE_ENABLE_TELEMETRY=1 and no endpoint is set\n- Classify returns NoTelemetry with X icon when CLAUDE_CODE_ENABLE_TELEMETRY=0 or is absent\n- Classify returns Unknown with question-mark icon when EnvReadable=false\n- The configured gRPC port is used for the 'correct port' check (not hardcoded 4317)\n- TestTelemetryClassifier_Connected passes\n- TestTelemetryClassifier_WrongPort passes\n- TestTelemetryClassifier_ConsoleOnly passes\n- TestTelemetryClassifier_NoTelemetry passes\n- TestTelemetryClassifier_Unknown passes","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T01:46:33.298479Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:23:17.307777Z","closed_at":"2026-02-15T02:23:17.307777Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.14","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:33.299807Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.14","depends_on_id":"cc-top-eho.7","type":"blocks","created_at":"2026-02-15T01:46:46.739199Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.14","depends_on_id":"cc-top-eho.2","type":"blocks","created_at":"2026-02-15T01:46:47.1402Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.15","title":"Implement PID-to-session correlator using port fingerprinting and timing heuristic","description":"The correlator maps Claude Code PIDs to OTLP session.ids using ephemeral source port tracking as the primary method and a 10-second timing heuristic as fallback.\n\n## Inputs\n- **connection_info** (`ConnectionInfo`): Source IP, source port, session.id from OTLP request -- Source: OTLP receivers\n- **process_list** (`list\u003cProcessInfo\u003e`): PIDs with open socket info -- Source: Process scanner\n\n## Outputs\n- **correlation** (`map\u003cPID, session.id\u003e`): Each PID maps to at most one session.id -- Dest: State store\n\n## Constraints\n- Port fingerprinting is primary; timing heuristic is fallback only\n- Uses proc_pidfdinfo macOS API (//go:build darwin)\n- Must handle race conditions where process exits between scan and correlation\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-pid-session-correlator\",\"files_scope\":[\"internal/correlator/correlator.go\",\"internal/correlator/correlator_test.go\",\"internal/correlator/portmap_darwin.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"connection_info\",\"type\":\"ConnectionInfo\",\"constraints\":\"Source IP, source port, session.id from OTLP request\",\"source\":\"OTLP receivers\"},{\"name\":\"process_list\",\"type\":\"list\\u003cProcessInfo\\u003e\",\"constraints\":\"PIDs with open socket info\",\"source\":\"Process scanner\"}],\"outputs\":[{\"name\":\"correlation\",\"type\":\"map\\u003cPID, session.id\\u003e\",\"constraints\":\"Each PID maps to at most one session.id\",\"destination\":\"State store\"}]}}","acceptance_criteria":"- When PID 4821 has an open socket from ephemeral port 52345 and an OTLP request arrives from port 52345 with session.id='sess-abc', the correlator maps PID 4821 to 'sess-abc'\n- When two PIDs have distinct source ports and sessions, each PID maps to its own session only\n- When port fingerprinting fails and a new PID appears within 10 seconds of a new session.id, the timing heuristic matches them\n- When a PID exits and a new PID starts, the old correlation is preserved as 'Exited' and the new PID gets a new correlation\n- When an OTLP session has no matching PID, it appears as 'PID: ---' in the store\n- Uses proc_pidfdinfo to enumerate open file descriptors for port-to-PID mapping\n- TestCorrelator_PortFingerprint passes\n- TestCorrelator_TimingHeuristic passes\n- TestCorrelator_NoMatch passes\n- TestCorrelator_TwoSessions passes","status":"closed","priority":0,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":480,"created_at":"2026-02-15T01:46:33.879319Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:25:20.377416Z","closed_at":"2026-02-15T02:25:20.377416Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.15","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:33.88043Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.15","depends_on_id":"cc-top-eho.7","type":"blocks","created_at":"2026-02-15T01:46:47.545675Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.15","depends_on_id":"cc-top-eho.3","type":"blocks","created_at":"2026-02-15T01:46:47.95634Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.16","title":"Implement graceful shutdown with drain, port release, and terminal restore","description":"Pressing q triggers graceful shutdown: stop accepting new connections, drain in-flight OTLP requests within 5 seconds, release ports, and restore the terminal to its original state.\n\n## Inputs\n- **quit_signal** (`KeyMsg`): q key press or SIGINT/SIGTERM -- Source: TUI keyboard or OS signal\n- **receivers** (`list\u003cReceiver\u003e`): gRPC and HTTP receivers -- Source: OTLP receivers\n- **tui_program** (`tea.Program`): Running Bubble Tea program -- Source: TUI\n\n## Outputs\n- **clean_exit** (`bool`): All resources released -- Dest: Process exit\n\n## Constraints\n- Use context.WithTimeout for 5-second drain\n- Register SIGINT/SIGTERM handlers\n- Bubble Tea's alternate screen cleanup must run even on forced exit\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-graceful-shutdown\",\"files_scope\":[\"internal/tui/shutdown.go\",\"cmd/cc-top/main.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"quit_signal\",\"type\":\"KeyMsg\",\"constraints\":\"q key press or SIGINT/SIGTERM\",\"source\":\"TUI keyboard or OS signal\"},{\"name\":\"receivers\",\"type\":\"list\\u003cReceiver\\u003e\",\"constraints\":\"gRPC and HTTP receivers\",\"source\":\"OTLP receivers\"},{\"name\":\"tui_program\",\"type\":\"tea.Program\",\"constraints\":\"Running Bubble Tea program\",\"source\":\"TUI\"}],\"outputs\":[{\"name\":\"clean_exit\",\"type\":\"bool\",\"constraints\":\"All resources released\",\"destination\":\"Process exit\"}]}}","acceptance_criteria":"- Pressing q stops accepting new OTLP connections immediately\n- In-flight OTLP requests are allowed up to 5 seconds to complete\n- After 5-second drain timeout, remaining connections are forcibly closed\n- Ports 4317 and 4318 (or custom) are released and immediately available for reuse\n- Terminal cursor is visible after exit\n- Terminal input echoing is enabled after exit\n- Alternate screen buffer is cleared after exit\n- Exit completes within 6 seconds (5s drain + 1s cleanup)\n- SIGINT and SIGTERM also trigger graceful shutdown\n- TestE2E_GracefulShutdown passes","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T01:46:34.45544Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:30:39.381536Z","closed_at":"2026-02-15T02:30:39.381536Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.16","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:34.456486Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.16","depends_on_id":"cc-top-eho.6","type":"blocks","created_at":"2026-02-15T01:46:48.362014Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.16","depends_on_id":"cc-top-eho.8","type":"blocks","created_at":"2026-02-15T01:46:48.758162Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.16","depends_on_id":"cc-top-eho.9","type":"blocks","created_at":"2026-02-15T01:46:49.149025Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.17","title":"Implement alert engine with 7 configurable alert rules","description":"The alert engine evaluates 7 rules (Cost Surge, Runaway Tokens, Loop Detector, Error Storm, Stale Session, Context Pressure, High Rejection Rate) against state store data and fires alerts with configurable thresholds.\n\n## Inputs\n- **state** (`StateStore`): Contains metrics and events indexed by session.id -- Source: State store\n- **config** (`AlertConfig`): Thresholds for each rule -- Source: Config parser\n- **model_limits** (`map\u003cstring, int\u003e`): Model name to context token limit -- Source: Config parser\n\n## Outputs\n- **alerts** (`list\u003cAlert\u003e`): Each alert has rule name, severity, message, session.id (if applicable) -- Dest: TUI alerts panel and system notification\n\n## Constraints\n- Evaluation runs on a configurable interval (default 1 second)\n- Each rule is independently configurable and can be disabled\n- osascript notification uses exec.Command, not CGo\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-alert-engine\",\"files_scope\":[\"internal/alerts/engine.go\",\"internal/alerts/engine_test.go\",\"internal/alerts/rules.go\",\"internal/alerts/notify_darwin.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"state\",\"type\":\"StateStore\",\"constraints\":\"Contains metrics and events indexed by session.id\",\"source\":\"State store\"},{\"name\":\"config\",\"type\":\"AlertConfig\",\"constraints\":\"Thresholds for each rule\",\"source\":\"Config parser\"},{\"name\":\"model_limits\",\"type\":\"map\\u003cstring, int\\u003e\",\"constraints\":\"Model name to context token limit\",\"source\":\"Config parser\"}],\"outputs\":[{\"name\":\"alerts\",\"type\":\"list\\u003cAlert\\u003e\",\"constraints\":\"Each alert has rule name, severity, message, session.id (if applicable)\",\"destination\":\"TUI alerts panel and system notification\"}]}}","acceptance_criteria":"- When $/hr exceeds $2.00 (default), a 'Cost Surge' alert fires with the current rate\n- When $/hr is $1.99, no 'Cost Surge' alert fires\n- When token velocity exceeds 50k tokens/min sustained for 3 minutes, 'Runaway Tokens' fires\n- When the same bash command hash fails 3 times in 5 minutes for a session, 'Loop Detector' fires for that session\n- When 3 normalized-equivalent commands fail (npm test/run test/npx jest), 'Loop Detector' fires\n- When \u003e10 api_error events occur in 1 minute, 'Error Storm' fires\n- When a session is active \u003e2 hours with 0 user_prompt events, 'Stale Session' fires\n- When input_tokens \u003e 80% of model context limit, 'Context Pressure' fires\n- When model is not in context limit map, no alert fires and a one-time warning is logged\n- When \u003e50% of tool_decisions are 'reject' in 5 minutes, 'High Rejection Rate' fires\n- Custom thresholds from config override all defaults\n- When system_notify=true, fired alerts trigger osascript display notification\n- When system_notify=false, no osascript is called but alert still appears in results\n- TestAlertCostSurge_Fires passes\n- TestAlertCostSurge_BelowThreshold passes\n- TestAlertRunawayTokens_Fires passes\n- TestAlertLoopDetector_Fires passes\n- TestAlertLoopDetector_Normalization passes\n- TestAlertErrorStorm_Fires passes\n- TestAlertStaleSession_Fires passes\n- TestAlertContextPressure_Fires passes\n- TestAlertContextPressure_UnknownModel passes\n- TestAlertHighRejection_Fires passes\n- TestAlertEngine_WithStateStore passes\n- TestAlertNotification_OSAScript passes","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":480,"created_at":"2026-02-15T01:46:35.036189Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:27:08.606247Z","closed_at":"2026-02-15T02:27:08.606247Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.17","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:35.037301Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.17","depends_on_id":"cc-top-eho.3","type":"blocks","created_at":"2026-02-15T01:46:49.540117Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.17","depends_on_id":"cc-top-eho.2","type":"blocks","created_at":"2026-02-15T01:46:49.952148Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.17","depends_on_id":"cc-top-eho.5","type":"blocks","created_at":"2026-02-15T01:46:50.363895Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.17","depends_on_id":"cc-top-eho.10","type":"blocks","created_at":"2026-02-15T01:46:50.75983Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.18","title":"Implement burn rate odometer panel with retro-styled digital counter","description":"The burn rate panel displays total cost, $/hour rate, trend arrow, and token velocity as a retro-styled digital counter with color thresholds (green/yellow/red).\n\n## Inputs\n- **burn_rate** (`BurnRate`): From burn rate calculator -- Source: Burn rate calculator\n- **selected_session** (`optional\u003cstring\u003e`): Session filter or nil for global -- Source: TUI state\n\n## Outputs\n- **panel_view** (`string`): Styled text with color-coded counter -- Dest: TUI layout\n\n## Constraints\n- Use Lipgloss for retro-styled digital counter appearance\n- Colors must be configurable via config thresholds\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-tui-burn-rate-odometer\",\"files_scope\":[\"internal/tui/burnrate.go\",\"internal/tui/burnrate_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"burn_rate\",\"type\":\"BurnRate\",\"constraints\":\"From burn rate calculator\",\"source\":\"Burn rate calculator\"},{\"name\":\"selected_session\",\"type\":\"optional\\u003cstring\\u003e\",\"constraints\":\"Session filter or nil for global\",\"source\":\"TUI state\"}],\"outputs\":[{\"name\":\"panel_view\",\"type\":\"string\",\"constraints\":\"Styled text with color-coded counter\",\"destination\":\"TUI layout\"}]}}","acceptance_criteria":"- Total cost displays as dollar amount with 2 decimal places\n- $/hour rate displays with 2 decimal places\n- Up-arrow appears when rate is increasing, down-arrow when decreasing\n- Counter color is green when rate \u003c $0.50/hr (default)\n- Counter color is yellow when rate $0.50-$1.99/hr (default)\n- Counter color is red when rate \u003e= $2.00/hr (default)\n- Token velocity displays as 'X,XXX tokens/min'\n- When a session is selected, shows only that session's data\n- When in global view, shows aggregate data from all sessions","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:35.622349Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:30:31.350685Z","closed_at":"2026-02-15T02:30:31.350685Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.18","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:35.623452Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.18","depends_on_id":"cc-top-eho.6","type":"blocks","created_at":"2026-02-15T01:46:51.154138Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.18","depends_on_id":"cc-top-eho.10","type":"blocks","created_at":"2026-02-15T01:46:51.55242Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.19","title":"Implement ring buffer for events with configurable capacity and eviction","description":"The event buffer stores up to N events (default 1000) in a ring buffer, evicting the oldest event when full, and supports filtered iteration by session and event type.\n\n## Inputs\n- **event** (`FormattedEvent`): Must have session.id and event type -- Source: Event formatter\n- **capacity** (`int`): capacity \u003e= 1 -- Source: Config (event_buffer_size)\n\n## Outputs\n- **events** (`list\u003cFormattedEvent\u003e`): Ordered newest-first, len \u003c= capacity -- Dest: Event stream panel\n\n## Constraints\n- Thread-safe for concurrent Add and List operations\n- Use ring buffer, not unbounded slice\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-event-buffer\",\"files_scope\":[\"internal/events/buffer.go\",\"internal/events/buffer_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"event\",\"type\":\"FormattedEvent\",\"constraints\":\"Must have session.id and event type\",\"source\":\"Event formatter\"},{\"name\":\"capacity\",\"type\":\"int\",\"constraints\":\"capacity \\u003e= 1\",\"source\":\"Config (event_buffer_size)\"}],\"outputs\":[{\"name\":\"events\",\"type\":\"list\\u003cFormattedEvent\\u003e\",\"constraints\":\"Ordered newest-first, len \\u003c= capacity\",\"destination\":\"Event stream panel\"}]}}","acceptance_criteria":"- Add() on a buffer with capacity 1000 stores events up to 1000\n- When event 1001 is added, the oldest event is evicted and only 1000 remain\n- ListBySession('sess-abc') returns only events for that session\n- ListByType('api_error') returns only api_error events\n- ListAll() returns events in chronological order (newest last)\n- A buffer with capacity=1 holds exactly 1 event after 100 adds\n- TestEventBuffer_Eviction passes","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T01:46:36.201119Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:20:34.470646Z","closed_at":"2026-02-15T02:20:34.470646Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.19","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:36.202226Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.19","depends_on_id":"cc-top-eho.11","type":"blocks","created_at":"2026-02-15T01:46:51.933817Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.2","title":"Implement TOML config parser with defaults and validation","description":"The config package loads ~/.config/cc-top/config.toml, merges with sensible defaults for all settings, and returns validation errors for invalid values.\n\n## Inputs\n- **config_file** (`optional\u003cstring\u003e`): Valid TOML syntax or absent -- Source: ~/.config/cc-top/config.toml\n\n## Outputs\n- **config** (`Config struct`): All fields populated with valid values -- Dest: Return value\n\n## Constraints\n- Use BurntSushi/toml for TOML parsing\n- All config values must have sensible defaults\n- Validate port ranges (1-65535), positive thresholds, positive buffer sizes\n\n## Error Cases\n- **Config file not found**: Use all defaults, no error -\u003e Valid Config with defaults\n- **Invalid TOML syntax**: Return parse error with file path and line number -\u003e Error message\n- **grpc_port = -1**: Return validation error -\u003e 'grpc_port must be between 1 and 65535'\n- **grpc_port = 65536**: Return validation error -\u003e 'grpc_port must be between 1 and 65535'\n- **event_buffer_size = 0**: Return validation error -\u003e 'event_buffer_size must be \u003e= 1'\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-config-parser\",\"files_scope\":[\"internal/config/config.go\",\"internal/config/config_test.go\",\"internal/config/defaults.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"config_file\",\"type\":\"optional\\u003cstring\\u003e\",\"constraints\":\"Valid TOML syntax or absent\",\"source\":\"~/.config/cc-top/config.toml\"}],\"outputs\":[{\"name\":\"config\",\"type\":\"Config struct\",\"constraints\":\"All fields populated with valid values\",\"destination\":\"Return value\"}]}}","acceptance_criteria":"- When no config file exists, Load() returns Config with gRPC port 4317, HTTP port 4318, scan interval 5s, event buffer 1000\n- When config.toml sets grpc_port = 5317, Load() returns Config with gRPC port 5317 and all other fields at defaults\n- When config.toml sets grpc_port = -1, Load() returns a validation error containing 'grpc_port must be between 1 and 65535'\n- When config.toml contains unknown_key = true, Load() returns Config with a warning logged about the unknown key\n- When config.toml sets model context limits under [models], they are available in Config.Models map\n- When config.toml sets alert thresholds, they override defaults in Config.Alerts\n- TestConfigParser_Defaults passes\n- TestConfigParser_CustomPorts passes\n- TestConfigParser_PartialConfig passes\n- TestConfigParser_InvalidValue passes\n- TestConfigParser_UnknownKey passes\n- TestConfigParser_ModelContextLimits passes","status":"closed","priority":0,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:26.185517Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:19:04.69033Z","closed_at":"2026-02-15T02:19:04.69033Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.2","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:26.187769Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.2","depends_on_id":"cc-top-eho.1","type":"blocks","created_at":"2026-02-15T01:46:40.081026Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.20","title":"Implement full-screen stats dashboard with Tab toggle","description":"The stats dashboard fills the full screen when toggled via Tab, displaying all 9 aggregate statistics in a formatted layout, and returns to the main dashboard on another Tab press.\n\n## Inputs\n- **stats** (`DashboardStats`): From stats calculator -- Source: Stats calculator\n- **selected_session** (`optional\u003cstring\u003e`): Session filter or nil for global -- Source: TUI state\n\n## Outputs\n- **full_screen_view** (`string`): Full terminal screen with all 9 stats -- Dest: Terminal\n\n## Constraints\n- Use Lipgloss for formatting\n- Must handle terminal resize\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-tui-stats-dashboard\",\"files_scope\":[\"internal/tui/stats.go\",\"internal/tui/stats_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"stats\",\"type\":\"DashboardStats\",\"constraints\":\"From stats calculator\",\"source\":\"Stats calculator\"},{\"name\":\"selected_session\",\"type\":\"optional\\u003cstring\\u003e\",\"constraints\":\"Session filter or nil for global\",\"source\":\"TUI state\"}],\"outputs\":[{\"name\":\"full_screen_view\",\"type\":\"string\",\"constraints\":\"Full terminal screen with all 9 stats\",\"destination\":\"Terminal\"}]}}","acceptance_criteria":"- Tab press from main dashboard shows full-screen stats view\n- Tab press from stats view returns to main dashboard\n- Stats view displays: lines added/removed, commits, PRs, tool acceptance rate by tool, cache efficiency %, average API latency, model breakdown (cost + tokens by model), top tools ranked by frequency, error rate %\n- When a session is selected, stats show only that session's data\n- When in global view, stats aggregate all sessions\n- Handles terminal resize correctly","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:36.781744Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:30:37.156544Z","closed_at":"2026-02-15T02:30:37.156544Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.20","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:36.790107Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.20","depends_on_id":"cc-top-eho.6","type":"blocks","created_at":"2026-02-15T01:46:52.321245Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.20","depends_on_id":"cc-top-eho.12","type":"blocks","created_at":"2026-02-15T01:46:52.699713Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.21","title":"Implement TUI startup screen with process table and action keys","description":"The startup screen displays a table of all discovered Claude Code processes with telemetry status and provides [E], [F], and [Enter] action keys for configuration and navigation.\n\n## Inputs\n- **processes** (`list\u003cProcessInfo\u003e`): From process scanner with telemetry classification -- Source: Process scanner + telemetry classifier\n- **settings_merge** (`SettingsMerge`): Merge capability for [E] and [F] actions -- Source: Settings merge package\n\n## Outputs\n- **tui_view** (`Bubble Tea Model`): Renders process table with action hints -- Dest: Terminal\n- **navigation** (`ViewTransition`): Enter transitions to main dashboard -- Dest: TUI router\n\n## Constraints\n- Use Bubble Tea framework for TUI\n- Must handle terminal resize\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-tui-startup-screen\",\"files_scope\":[\"internal/tui/startup.go\",\"internal/tui/startup_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"processes\",\"type\":\"list\\u003cProcessInfo\\u003e\",\"constraints\":\"From process scanner with telemetry classification\",\"source\":\"Process scanner + telemetry classifier\"},{\"name\":\"settings_merge\",\"type\":\"SettingsMerge\",\"constraints\":\"Merge capability for [E] and [F] actions\",\"source\":\"Settings merge package\"}],\"outputs\":[{\"name\":\"tui_view\",\"type\":\"Bubble Tea Model\",\"constraints\":\"Renders process table with action hints\",\"destination\":\"Terminal\"},{\"name\":\"navigation\",\"type\":\"ViewTransition\",\"constraints\":\"Enter transitions to main dashboard\",\"destination\":\"TUI router\"}]}}","acceptance_criteria":"- Startup screen shows a table with columns: PID, Terminal, CWD, Telemetry, OTLP Dest, Status\n- A summary line shows 'N connected, N misconfigured, N no telemetry'\n- Pressing [E] merges OTel env vars into settings.json and shows confirmation message\n- Pressing [F] updates only the endpoint in settings.json when 'Wrong port' sessions exist\n- Pressing Enter transitions to the main dashboard\n- When all sessions are correctly configured, [E] and [F] are greyed out\n- When no processes are found, screen shows 'No Claude Code instances found' with hint to start one\n- Pressing [R] triggers a rescan","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:37.373322Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:30:36.019347Z","closed_at":"2026-02-15T02:30:36.019347Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.21","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:37.37481Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.21","depends_on_id":"cc-top-eho.7","type":"blocks","created_at":"2026-02-15T01:46:53.084447Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.21","depends_on_id":"cc-top-eho.14","type":"blocks","created_at":"2026-02-15T01:46:53.464819Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.21","depends_on_id":"cc-top-eho.4","type":"blocks","created_at":"2026-02-15T01:46:53.848391Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.22","title":"Implement session list panel with navigation and selection","description":"The session list panel displays all sessions with full metadata, supports keyboard navigation and selection, and updates all other panels when a session is selected or deselected.\n\n## Inputs\n- **sessions** (`list\u003cSessionData\u003e`): From state store with correlation and classification data -- Source: State store\n- **selected** (`optional\u003cstring\u003e`): session.id or nil for global view -- Source: TUI state\n\n## Outputs\n- **panel_view** (`string`): Formatted session rows -- Dest: TUI layout\n- **selection_event** (`SessionSelectedMsg`): Emitted on Enter/Esc -- Dest: Other TUI panels\n\n## Constraints\n- Long CWD paths must be truncated with ~ substitution and ellipsis\n- Session ID truncated to 8 characters\n- Active time formatted as HH:MM:SS\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-tui-session-list\",\"files_scope\":[\"internal/tui/sessionlist.go\",\"internal/tui/sessionlist_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"sessions\",\"type\":\"list\\u003cSessionData\\u003e\",\"constraints\":\"From state store with correlation and classification data\",\"source\":\"State store\"},{\"name\":\"selected\",\"type\":\"optional\\u003cstring\\u003e\",\"constraints\":\"session.id or nil for global view\",\"source\":\"TUI state\"}],\"outputs\":[{\"name\":\"panel_view\",\"type\":\"string\",\"constraints\":\"Formatted session rows\",\"destination\":\"TUI layout\"},{\"name\":\"selection_event\",\"type\":\"SessionSelectedMsg\",\"constraints\":\"Emitted on Enter/Esc\",\"destination\":\"Other TUI panels\"}]}}","acceptance_criteria":"- Each session row shows PID, truncated session ID (8 chars), terminal, CWD (with ~ substitution and ellipsis), telemetry icon, model, status, cost, tokens, and active time\n- Status shows 'active' when last event was within 30 seconds\n- Status shows 'idle' when last event was 30s-5min ago\n- Status shows 'done' when last event was \u003e5min ago\n- Status shows 'exited' for processes that have exited, with final stats preserved\n- Non-telemetry sessions appear greyed out at the bottom\n- Arrow keys navigate up/down, Enter selects, Esc returns to global view\n- When a session is selected, all other panels filter to that session\n- When Esc is pressed, panels return to aggregate global view\n- CWD paths \u003e30 chars are truncated with ~ home-dir substitution and ellipsis\n- TestSessionStatus_Active passes\n- TestSessionStatus_Idle passes\n- TestSessionStatus_Done passes\n- TestTUIModel_SessionSelection passes","status":"closed","priority":0,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:37.949464Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:30:32.482019Z","closed_at":"2026-02-15T02:30:32.482019Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.22","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:37.950599Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.22","depends_on_id":"cc-top-eho.6","type":"blocks","created_at":"2026-02-15T01:46:54.237839Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.22","depends_on_id":"cc-top-eho.3","type":"blocks","created_at":"2026-02-15T01:46:54.667534Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.22","depends_on_id":"cc-top-eho.14","type":"blocks","created_at":"2026-02-15T01:46:55.077063Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.23","title":"Implement alerts panel in bottom bar with system notification integration","description":"The alerts panel displays triggered alerts in a bottom bar with severity icons and supports optional macOS system notifications via osascript.\n\n## Inputs\n- **alerts** (`list\u003cAlert\u003e`): From alert engine -- Source: Alert engine\n- **notify_enabled** (`bool`): From config system_notify -- Source: Config\n\n## Outputs\n- **panel_view** (`string`): Bottom bar with alert messages -- Dest: TUI layout\n\n## Constraints\n- osascript calls must be non-blocking (use goroutine)\n- Do not duplicate notifications for the same alert within 60 seconds\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-tui-alerts-panel\",\"files_scope\":[\"internal/tui/alerts.go\",\"internal/tui/alerts_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"alerts\",\"type\":\"list\\u003cAlert\\u003e\",\"constraints\":\"From alert engine\",\"source\":\"Alert engine\"},{\"name\":\"notify_enabled\",\"type\":\"bool\",\"constraints\":\"From config system_notify\",\"source\":\"Config\"}],\"outputs\":[{\"name\":\"panel_view\",\"type\":\"string\",\"constraints\":\"Bottom bar with alert messages\",\"destination\":\"TUI layout\"}]}}","acceptance_criteria":"- When no alerts are active, the bottom bar shows a status line\n- When a 'Cost Surge' alert fires, it appears in the bottom bar with a warning icon and the rate value\n- Multiple alerts display in a scrollable list if they exceed the bar width\n- Alert messages include the rule name, severity, and relevant values\n- When system_notify=true, osascript display notification is called for each new alert\n- When system_notify=false, no osascript calls occur\n- Alerts for a selected session are highlighted","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T01:46:38.541728Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:30:34.854474Z","closed_at":"2026-02-15T02:30:34.854474Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.23","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:38.543042Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.23","depends_on_id":"cc-top-eho.6","type":"blocks","created_at":"2026-02-15T01:46:55.50693Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.23","depends_on_id":"cc-top-eho.17","type":"blocks","created_at":"2026-02-15T01:46:55.914221Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.24","title":"Implement event stream panel with filtering and auto-scroll","description":"The event stream panel displays a real-time scrolling feed of formatted events, supports filtering by session, event type, and success/failure, and auto-scrolls to show newest events.\n\n## Inputs\n- **events** (`list\u003cFormattedEvent\u003e`): From event buffer, pre-formatted -- Source: Event buffer\n- **filters** (`EventFilters`): Optional session, type, and success filters -- Source: TUI state\n\n## Outputs\n- **panel_view** (`string`): Filtered, scrollable event list -- Dest: TUI layout\n\n## Constraints\n- Render at configurable refresh rate (default 500ms) to avoid TUI freezes\n- Buffer events between renders\n- Use Bubble Tea viewport for scrolling\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-tui-event-stream\",\"files_scope\":[\"internal/tui/eventstream.go\",\"internal/tui/eventstream_test.go\",\"internal/tui/filter.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"events\",\"type\":\"list\\u003cFormattedEvent\\u003e\",\"constraints\":\"From event buffer, pre-formatted\",\"source\":\"Event buffer\"},{\"name\":\"filters\",\"type\":\"EventFilters\",\"constraints\":\"Optional session, type, and success filters\",\"source\":\"TUI state\"}],\"outputs\":[{\"name\":\"panel_view\",\"type\":\"string\",\"constraints\":\"Filtered, scrollable event list\",\"destination\":\"TUI layout\"}]}}","acceptance_criteria":"- Events render in chronological order with newest at bottom\n- Panel auto-scrolls to newest event on update\n- Pressing 'f' opens a filter menu with session, event type, and success/failure options\n- Applying a filter immediately updates the visible events\n- When a session is selected in the session list, only that session's events show\n- When no events exist, panel shows 'No data received yet'\n- Panel remains responsive with 200 events/second input (renders at 500ms intervals)\n- Scroll up/down with j/k or arrow keys when panel is focused","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:39.115359Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:30:33.642623Z","closed_at":"2026-02-15T02:30:33.642623Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.24","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:39.116577Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.24","depends_on_id":"cc-top-eho.6","type":"blocks","created_at":"2026-02-15T01:46:56.297137Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.24","depends_on_id":"cc-top-eho.19","type":"blocks","created_at":"2026-02-15T01:46:56.732482Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.25","title":"Implement kill switch with SIGSTOP/SIGKILL/SIGCONT and confirmation dialog","description":"The kill switch (Ctrl+K) sends SIGSTOP to freeze the selected session's process, shows a confirmation dialog, then sends SIGKILL on confirm or SIGCONT on cancel.\n\n## Inputs\n- **selected_session** (`optional\u003cSessionData\u003e`): Must have a PID, or show picker if no selection -- Source: TUI state\n- **user_confirmation** (`bool`): Y to kill, n/Esc to cancel -- Source: TUI keyboard input\n\n## Outputs\n- **signal_sent** (`Signal`): SIGSTOP, then SIGKILL or SIGCONT -- Dest: Target process group\n- **session_update** (`SessionStatus`): Marked 'Exited' on kill -- Dest: State store\n\n## Constraints\n- Send signals to process group (-PID), not just PID\n- Handle ESRCH (no such process) gracefully\n- Must work on macOS (syscall.Kill)\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-kill-switch\",\"files_scope\":[\"internal/tui/killswitch.go\",\"internal/tui/killswitch_test.go\",\"internal/process/signal.go\",\"internal/process/signal_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"selected_session\",\"type\":\"optional\\u003cSessionData\\u003e\",\"constraints\":\"Must have a PID, or show picker if no selection\",\"source\":\"TUI state\"},{\"name\":\"user_confirmation\",\"type\":\"bool\",\"constraints\":\"Y to kill, n/Esc to cancel\",\"source\":\"TUI keyboard input\"}],\"outputs\":[{\"name\":\"signal_sent\",\"type\":\"Signal\",\"constraints\":\"SIGSTOP, then SIGKILL or SIGCONT\",\"destination\":\"Target process group\"},{\"name\":\"session_update\",\"type\":\"SessionStatus\",\"constraints\":\"Marked 'Exited' on kill\",\"destination\":\"State store\"}]}}","acceptance_criteria":"- Ctrl+K on a selected session sends SIGSTOP to the process group\n- Confirmation dialog shows 'Kill session \u003cid\u003e (PID \u003cpid\u003e, \u003ccwd\u003e)? [Y/n]'\n- Y confirms: SIGKILL sent to process group, session marked 'Exited'\n- n or Esc cancels: SIGCONT sent to process group, dialog closes, session resumes\n- When no session is selected (global view), a session picker appears listing all active sessions\n- When the target process has already exited, the 'no such process' error is handled gracefully and session is marked 'Exited'\n- When an already-exited session is selected and Ctrl+K pressed, 'Session already exited' message displays and no signals are sent\n- TestKillSwitch_SIGSTOPAndKill passes\n- TestKillSwitch_Cancel_SIGCONT passes\n- TestKillSwitch_ExitedProcess passes","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:39.688151Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:30:38.276171Z","closed_at":"2026-02-15T02:30:38.276171Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.25","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:39.689363Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.25","depends_on_id":"cc-top-eho.22","type":"blocks","created_at":"2026-02-15T01:46:57.171829Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.25","depends_on_id":"cc-top-eho.7","type":"blocks","created_at":"2026-02-15T01:46:57.576586Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.3","title":"Implement in-memory state store indexed by session ID","description":"The state store provides thread-safe storage and retrieval of OTLP metrics and events indexed by session.id, with support for session enumeration and aggregate queries.\n\n## Inputs\n- **metric** (`OTLPMetric`): May or may not have session.id attribute -- Source: OTLP receiver\n- **event** (`OTLPEvent`): May or may not have session.id attribute -- Source: OTLP receiver\n\n## Outputs\n- **session_data** (`map\u003cstring, SessionData\u003e`): Thread-safe read/write -- Dest: In-memory, queried by TUI and alert engine\n\n## Constraints\n- Use sync.RWMutex for thread-safe access\n- No persistence — all state is in-memory only\n- Must handle counter resets (negative deltas) by treating previous value as 0\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-state-store\",\"files_scope\":[\"internal/state/store.go\",\"internal/state/store_test.go\",\"internal/state/session.go\",\"internal/state/types.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"metric\",\"type\":\"OTLPMetric\",\"constraints\":\"May or may not have session.id attribute\",\"source\":\"OTLP receiver\"},{\"name\":\"event\",\"type\":\"OTLPEvent\",\"constraints\":\"May or may not have session.id attribute\",\"source\":\"OTLP receiver\"}],\"outputs\":[{\"name\":\"session_data\",\"type\":\"map\\u003cstring, SessionData\\u003e\",\"constraints\":\"Thread-safe read/write\",\"destination\":\"In-memory, queried by TUI and alert engine\"}]}}","acceptance_criteria":"- AddMetric with session.id='sess-001' stores the metric retrievable via GetSession('sess-001')\n- AddEvent with session.id='sess-002' stores the event retrievable via GetSession('sess-002')\n- AddMetric with missing session.id stores under 'unknown' session bucket\n- AddEvent with missing session.id stores under 'unknown' session bucket and logs a warning\n- ListSessions() returns all session IDs including 'unknown' if populated\n- Concurrent AddMetric calls from multiple goroutines do not cause data races (go test -race passes)\n- GetAggregatedCost() returns the sum of cost.usage across all sessions\n- TestStateStore_IndexMetricBySessionID passes\n- TestStateStore_IndexEventBySessionID passes\n- TestStateStore_MissingSessID passes","status":"closed","priority":0,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:26.788321Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:18:18.541335Z","closed_at":"2026-02-15T02:18:18.541335Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.3","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:26.789533Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.3","depends_on_id":"cc-top-eho.1","type":"blocks","created_at":"2026-02-15T01:46:40.465703Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.4","title":"Implement settings.json merge logic for OTel environment variables","description":"The settings package reads ~/.claude/settings.json, merges required OTel environment variables into the 'env' block, preserves all other keys and original indentation, and handles all error conditions.\n\n## Inputs\n- **settings_path** (`string`): Default ~/.claude/settings.json -- Source: Filesystem\n- **interactive** (`bool`): true for TUI, false for --setup CLI -- Source: Caller context\n- **fix_port_only** (`bool`): true when [F] pressed, false for [E] -- Source: Caller context\n\n## Outputs\n- **updated_file** (`JSON file`): Valid JSON preserving original indentation -- Dest: ~/.claude/settings.json\n- **result** (`MergeResult`): Success, AlreadyConfigured, Error, or NeedsConfirmation -- Dest: Return value\n\n## Constraints\n- Use atomic write (write to temp file, then rename) to avoid corruption\n- Detect indentation by examining first indented line of original file\n- Never lose data — backup before any destructive operation\n\n## Error Cases\n- **File does not exist**: Create with OTel env vars -\u003e New file with env block\n- **Malformed JSON**: Create .bak backup, return error -\u003e Error: settings.json contains invalid JSON. Backup saved.\n- **Permission denied**: Return error, no crash -\u003e Error: permission denied writing to ~/.claude/settings.json\n- **Concurrent write by another tool**: Atomic write via temp+rename prevents corruption -\u003e Clean file or error\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-settings-merge\",\"files_scope\":[\"internal/settings/merge.go\",\"internal/settings/merge_test.go\",\"internal/settings/indent.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"settings_path\",\"type\":\"string\",\"constraints\":\"Default ~/.claude/settings.json\",\"source\":\"Filesystem\"},{\"name\":\"interactive\",\"type\":\"bool\",\"constraints\":\"true for TUI, false for --setup CLI\",\"source\":\"Caller context\"},{\"name\":\"fix_port_only\",\"type\":\"bool\",\"constraints\":\"true when [F] pressed, false for [E]\",\"source\":\"Caller context\"}],\"outputs\":[{\"name\":\"updated_file\",\"type\":\"JSON file\",\"constraints\":\"Valid JSON preserving original indentation\",\"destination\":\"~/.claude/settings.json\"},{\"name\":\"result\",\"type\":\"MergeResult\",\"constraints\":\"Success, AlreadyConfigured, Error, or NeedsConfirmation\",\"destination\":\"Return value\"}]}}","acceptance_criteria":"- Given {\"env\": {\"MY_VAR\": \"keep\"}, \"other_key\": true}, Merge adds OTel keys to env block and MY_VAR is still 'keep' and other_key is still true\n- When settings.json does not exist, Merge creates it with the required OTel env vars\n- When all OTel keys are already correct, Merge returns AlreadyConfigured and does not write the file\n- When settings.json contains invalid JSON, Merge creates a .bak backup and returns an error without writing\n- When settings.json is read-only, Merge returns an error containing 'permission denied'\n- When settings.json uses 4-space indentation, the output preserves 4-space indentation\n- When fix_port_only=true, only OTEL_EXPORTER_OTLP_ENDPOINT is updated\n- When interactive=false and an existing value differs, Merge warns but does not overwrite\n- TestSettingsMerge_AddKeys passes\n- TestSettingsMerge_CreateFile passes\n- TestSettingsMerge_PreserveIndent passes\n- TestSettingsMerge_AlreadyConfigured passes\n- TestSettingsMerge_MalformedJSON passes\n- TestSettingsMerge_PermissionDenied passes\n- TestSettingsMerge_DifferentValue_NonInteractive passes\n- TestSettingsMerge_FixWrongPort passes","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:27.392073Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:21:52.166064Z","closed_at":"2026-02-15T02:21:52.166064Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.4","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:27.39334Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.4","depends_on_id":"cc-top-eho.1","type":"blocks","created_at":"2026-02-15T01:46:40.845284Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.5","title":"Implement command normalizer for semantically similar bash commands","description":"The command normalizer groups semantically similar bash commands (e.g., npm test, npm run test, npx jest) into the same group by prefix matching, returning a stable hash for each group.\n\n## Inputs\n- **command** (`string`): Raw bash command from tool_result event -- Source: OTLP event attributes\n\n## Outputs\n- **normalized_hash** (`string`): Stable hash for the command group -- Dest: Alert engine loop detector\n\n## Constraints\n- Use prefix matching for grouping, not exact string comparison\n- Known test-runner families: npm/npx/yarn test variants, pytest variants, go test variants\n- Unknown commands get their own hash (no false grouping)\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-command-normalizer\",\"files_scope\":[\"internal/alerts/normalizer.go\",\"internal/alerts/normalizer_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"command\",\"type\":\"string\",\"constraints\":\"Raw bash command from tool_result event\",\"source\":\"OTLP event attributes\"}],\"outputs\":[{\"name\":\"normalized_hash\",\"type\":\"string\",\"constraints\":\"Stable hash for the command group\",\"destination\":\"Alert engine loop detector\"}]}}","acceptance_criteria":"- Normalize('npm test') and Normalize('npm run test') and Normalize('npx jest') return the same hash\n- Normalize('python -m pytest') and Normalize('pytest') return the same hash\n- Normalize('go test ./...') and Normalize('go test ./pkg/...') return the same hash\n- Normalize('ls -la') returns a unique hash (not grouped with test commands)\n- Normalize('') returns empty string (no hash for empty commands)\n- A 10KB command string is hashed without error\n- TestCommandNormalizer_PrefixMatch passes","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T01:46:27.987728Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:17:53.408129Z","closed_at":"2026-02-15T02:17:53.408129Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.5","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:27.989346Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.5","depends_on_id":"cc-top-eho.1","type":"blocks","created_at":"2026-02-15T01:46:41.236703Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.6","title":"Implement main dashboard TUI layout with panel arrangement","description":"The main dashboard arranges the session list, burn rate odometer, event stream, and alerts panels in a responsive layout that handles terminal resize.\n\n## Inputs\n- **terminal_size** (`tuple(int, int)`): Width \u003e= 80, Height \u003e= 24 -- Source: Bubble Tea WindowSizeMsg\n- **active_view** (`ViewState`): Dashboard or Stats -- Source: TUI state\n\n## Outputs\n- **layout** (`Bubble Tea Model`): All panels visible and correctly sized -- Dest: Terminal\n\n## Constraints\n- Use Bubble Tea for TUI framework\n- Use Lipgloss for styling\n- Use Bubbles for reusable components\n- Must re-layout on terminal resize without data loss\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-tui-main-layout\",\"files_scope\":[\"internal/tui/layout.go\",\"internal/tui/layout_test.go\",\"internal/tui/model.go\",\"internal/tui/keys.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"terminal_size\",\"type\":\"tuple(int, int)\",\"constraints\":\"Width \\u003e= 80, Height \\u003e= 24\",\"source\":\"Bubble Tea WindowSizeMsg\"},{\"name\":\"active_view\",\"type\":\"ViewState\",\"constraints\":\"Dashboard or Stats\",\"source\":\"TUI state\"}],\"outputs\":[{\"name\":\"layout\",\"type\":\"Bubble Tea Model\",\"constraints\":\"All panels visible and correctly sized\",\"destination\":\"Terminal\"}]}}","acceptance_criteria":"- At 120x40, all four panels (session list, burn rate, event stream, alerts) are visible\n- At 80x24, panels resize to fit without data loss\n- Tab key toggles between main dashboard and stats dashboard full-screen view\n- q key triggers graceful shutdown\n- All keyboard shortcuts (arrows, Enter, Esc, f, Tab, Ctrl+K) are routed to correct handlers\n- TestTUIModel_TabToggle passes","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:28.621591Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:30:30.188159Z","closed_at":"2026-02-15T02:30:30.188159Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.6","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:28.622828Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.6","depends_on_id":"cc-top-eho.1","type":"blocks","created_at":"2026-02-15T01:46:41.639175Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.7","title":"Implement macOS process scanner for Claude Code detection","description":"The process scanner uses macOS libproc APIs to discover all running Claude Code processes, returning PID, binary name, command-line arguments, CWD, terminal type, and environment variables for each.\n\n## Inputs\n- **scan_interval** (`duration`): Default 5 seconds, configurable -- Source: Config\n\n## Outputs\n- **processes** (`list\u003cProcessInfo\u003e`): Only processes owned by current user -- Dest: State store and correlator\n\n## Constraints\n- Use macOS libproc APIs: proc_listallpids, proc_pidinfo, sysctl KERN_PROCARGS2\n- No root/sudo required — only scan current user's processes\n- Must use //go:build darwin build tag\n- Must not crash on zombie or permission-denied processes\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-process-scanner\",\"files_scope\":[\"internal/scanner/scanner.go\",\"internal/scanner/scanner_test.go\",\"internal/scanner/libproc_darwin.go\",\"internal/scanner/types.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"scan_interval\",\"type\":\"duration\",\"constraints\":\"Default 5 seconds, configurable\",\"source\":\"Config\"}],\"outputs\":[{\"name\":\"processes\",\"type\":\"list\\u003cProcessInfo\\u003e\",\"constraints\":\"Only processes owned by current user\",\"destination\":\"State store and correlator\"}]}}","acceptance_criteria":"- Scan() returns a ProcessInfo for each running process named 'claude' owned by the current user\n- Scan() detects a 'node' process with '@anthropic-ai/claude-code' in its argv as a Claude Code instance\n- A process named 'claude-helper' is NOT detected (no false positives)\n- Each ProcessInfo includes PID, binary name, CWD, terminal type, and raw environment string\n- Zombie processes with unreadable env vars return a ProcessInfo with EnvReadable=false and no crash\n- StartPeriodicScan() calls Scan() every scan_interval and publishes updates\n- When a new PID appears, it is tagged as 'New' for one scan cycle\n- When a previously seen PID disappears, it is tagged as 'Exited' with preserved last-known data\n- Uses //go:build darwin build tag for macOS-specific code\n- TestProcessScanner_DetectClaude passes\n- TestProcessScanner_DetectNodeClaude passes\n- TestProcessScanner_NewProcess passes\n- TestProcessScanner_ExitedProcess passes","status":"closed","priority":0,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":480,"created_at":"2026-02-15T01:46:29.205454Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:22:07.459211Z","closed_at":"2026-02-15T02:22:07.459211Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.7","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:29.206569Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.7","depends_on_id":"cc-top-eho.1","type":"blocks","created_at":"2026-02-15T01:46:42.034928Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.7","depends_on_id":"cc-top-eho.2","type":"blocks","created_at":"2026-02-15T01:46:42.428391Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.8","title":"Implement OTLP gRPC receiver for metrics ingestion","description":"The gRPC receiver listens on the configured port, accepts ExportMetricsServiceRequest payloads, extracts session.id, and stores metrics in the state store.\n\n## Inputs\n- **otlp_request** (`ExportMetricsServiceRequest (protobuf)`): Valid OTLP v1 protobuf -- Source: gRPC connection on configured port\n- **config** (`Config`): Valid gRPC port -- Source: Config parser\n\n## Outputs\n- **stored_metrics** (`Metrics in state store`): Indexed by session.id -- Dest: State store\n- **grpc_response** (`ExportMetricsServiceResponse`): Standard OTLP response -- Dest: gRPC client\n\n## Constraints\n- Use go.opentelemetry.io/collector/receiver/otlpreceiver or hand-rolled gRPC server with OTLP proto\n- Capture inbound connection source port for PID-to-session correlation\n- Must not crash on malformed input\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-otlp-grpc-receiver\",\"files_scope\":[\"internal/receiver/grpc.go\",\"internal/receiver/grpc_test.go\",\"internal/receiver/server.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"otlp_request\",\"type\":\"ExportMetricsServiceRequest (protobuf)\",\"constraints\":\"Valid OTLP v1 protobuf\",\"source\":\"gRPC connection on configured port\"},{\"name\":\"config\",\"type\":\"Config\",\"constraints\":\"Valid gRPC port\",\"source\":\"Config parser\"}],\"outputs\":[{\"name\":\"stored_metrics\",\"type\":\"Metrics in state store\",\"constraints\":\"Indexed by session.id\",\"destination\":\"State store\"},{\"name\":\"grpc_response\",\"type\":\"ExportMetricsServiceResponse\",\"constraints\":\"Standard OTLP response\",\"destination\":\"gRPC client\"}]}}","acceptance_criteria":"- Receiver binds to configured gRPC port (default 4317) on startup\n- A valid ExportMetricsServiceRequest with session.id='sess-001' and cost.usage metric is stored in the state store under 'sess-001'\n- A malformed protobuf payload returns an OTLP error response and receiver continues accepting new requests\n- When the configured port is already in use, Start() returns an error containing 'port 4317 already in use'\n- The source port of the inbound connection is captured and made available for PID correlation\n- TestOTLPReceiver_GRPCMetrics passes\n- TestOTLPReceiver_MalformedPayload passes\n- TestOTLPReceiver_PortConflict passes","status":"closed","priority":0,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":480,"created_at":"2026-02-15T01:46:29.784971Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:26:58.966806Z","closed_at":"2026-02-15T02:26:58.966806Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.8","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:29.786311Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.8","depends_on_id":"cc-top-eho.3","type":"blocks","created_at":"2026-02-15T01:46:42.814987Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.8","depends_on_id":"cc-top-eho.2","type":"blocks","created_at":"2026-02-15T01:46:43.200043Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-eho.9","title":"Implement OTLP HTTP receiver for log event ingestion","description":"The HTTP receiver listens on the configured port, accepts OTLP log export requests via HTTP POST, extracts session.id, and stores events in the state store.\n\n## Inputs\n- **otlp_request** (`ExportLogsServiceRequest (protobuf or JSON)`): Valid OTLP v1 payload -- Source: HTTP POST on configured port\n- **config** (`Config`): Valid HTTP port -- Source: Config parser\n\n## Outputs\n- **stored_events** (`Events in state store`): Indexed by session.id -- Dest: State store\n- **http_response** (`HTTP response`): 200 OK or appropriate error code -- Dest: HTTP client\n\n## Constraints\n- Support both protobuf and JSON OTLP encoding\n- Capture inbound connection source port for PID-to-session correlation\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-otlp-http-receiver\",\"files_scope\":[\"internal/receiver/http.go\",\"internal/receiver/http_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"otlp_request\",\"type\":\"ExportLogsServiceRequest (protobuf or JSON)\",\"constraints\":\"Valid OTLP v1 payload\",\"source\":\"HTTP POST on configured port\"},{\"name\":\"config\",\"type\":\"Config\",\"constraints\":\"Valid HTTP port\",\"source\":\"Config parser\"}],\"outputs\":[{\"name\":\"stored_events\",\"type\":\"Events in state store\",\"constraints\":\"Indexed by session.id\",\"destination\":\"State store\"},{\"name\":\"http_response\",\"type\":\"HTTP response\",\"constraints\":\"200 OK or appropriate error code\",\"destination\":\"HTTP client\"}]}}","acceptance_criteria":"- Receiver binds to configured HTTP port (default 4318) on startup\n- A valid OTLP log export POST with session.id='sess-002' stores the event under 'sess-002' in the state store\n- An invalid payload returns HTTP 400 with OTLP error body and receiver continues\n- When the configured port is already in use, Start() returns an error containing the port number\n- TestOTLPReceiver_HTTPEvents passes","status":"closed","priority":0,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:30.352351Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:27:01.936182Z","closed_at":"2026-02-15T02:27:01.936182Z","close_reason":"Closed","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-eho.9","depends_on_id":"cc-top-eho","type":"parent-child","created_at":"2026-02-15T01:46:30.353864Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.9","depends_on_id":"cc-top-eho.3","type":"blocks","created_at":"2026-02-15T01:46:43.588239Z","created_by":"Igor Ryabchuk"},{"issue_id":"cc-top-eho.9","depends_on_id":"cc-top-eho.2","type":"blocks","created_at":"2026-02-15T01:46:43.991768Z","created_by":"Igor Ryabchuk"}]}
{"id":"cc-top-pyh","title":"Add sustained duration check to runaway tokens rule","description":"alerts/rules.go runawayTokensRule fires immediately when token velocity exceeds threshold. Spec requires velocity to be sustained above threshold for \u003e N minutes before firing. Currently no duration tracking exists and no RunawayTokenSustainedMinutes config field. Fix: add state tracking for how long velocity has been elevated, add config field for sustained duration (suggest default 2 min), only fire after sustained period.","status":"closed","priority":2,"issue_type":"bug","owner":"riabtchuk@gmail.com","created_at":"2026-02-15T04:21:54.585169Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T04:43:25.979152Z","closed_at":"2026-02-15T04:43:25.979152Z","close_reason":"Fixed by parallel agent team"}
{"id":"cc-top-yqx","title":"Fix double cost counting in state store","description":"state/store.go accumulates cost from BOTH cost.usage metrics (via AddMetric delta at line ~154) AND api_request event cost_usd attribute (via AddEvent at lines 193-198). If both metrics and events arrive for the same session, costs are doubled. Fix: choose one authoritative source. The spec lists cost.usage metric as the source for burn rate. Remove the cost accumulation from AddEvent, or deduplicate.","status":"closed","priority":1,"issue_type":"bug","owner":"riabtchuk@gmail.com","created_at":"2026-02-15T04:21:46.710823Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T04:43:25.967883Z","closed_at":"2026-02-15T04:43:25.967883Z","close_reason":"Fixed by parallel agent team"}
